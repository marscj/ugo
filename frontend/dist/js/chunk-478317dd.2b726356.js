(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-478317dd"],{"2b1f":function(t,a,e){"use strict";var r=e("9bfb"),n=e.n(r);n.a},"51f0":function(t,a,e){"use strict";var r=e("ca16"),n=e.n(r);n.a},"7a13":function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("a-card",{staticClass:"table-page-search-wrapper",attrs:{bordered:!1}},[e("template",{slot:"extra"},[e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:48}},[e("a-col",{attrs:{xs:6,md:6,sm:24}},[e("a-form-item",{attrs:{label:"OrderID"}},[e("a-input",{attrs:{placeholder:""},model:{value:t.queryParam.orderID,callback:function(a){t.$set(t.queryParam,"orderID",a)},expression:"queryParam.orderID"}})],1)],1),e("a-col",{attrs:{xs:6,md:6,sm:24}},[e("a-form-item",{attrs:{label:"Customer"}},[e("a-input",{attrs:{placeholder:""},model:{value:t.queryParam.customer,callback:function(a){t.$set(t.queryParam,"customer",a)},expression:"queryParam.customer"}})],1)],1),e("a-col",{attrs:{xs:6,md:6,sm:24}},[e("a-form-item",{attrs:{label:"Operator"}},[e("a-input",{attrs:{placeholder:""},model:{value:t.queryParam.operator,callback:function(a){t.$set(t.queryParam,"operator",a)},expression:"queryParam.operator"}})],1)],1),e("a-col",{attrs:{xs:6,md:6,sm:24}},[e("a-form-item",{attrs:{label:"Action Day"}},[e("a-range-picker",{attrs:{value:t.day},on:{change:function(a){return t.day=a}}})],1)],1),e("a-col",{attrs:{xs:6,md:6,sm:24}},[e("a-form-item",{attrs:{label:"RelatedID"}},[e("a-input",{attrs:{placeholder:""},model:{value:t.queryParam.relatedID,callback:function(a){t.$set(t.queryParam,"relatedID",a)},expression:"queryParam.relatedID"}})],1)],1),e("a-col",{attrs:{xs:8,md:6,sm:24}},[e("a-form-item",{attrs:{label:"Product"}},[e("a-input",{attrs:{placeholder:""},model:{value:t.queryParam.product,callback:function(a){t.$set(t.queryParam,"product",a)},expression:"queryParam.product"}})],1)],1),e("a-col",{attrs:{xs:8,md:6,sm:24}},[e("a-form-item",{attrs:{label:"Variant"}},[e("a-input",{attrs:{placeholder:""},model:{value:t.queryParam.variant,callback:function(a){t.$set(t.queryParam,"variant",a)},expression:"queryParam.variant"}})],1)],1),e("a-col",{attrs:{xs:8,md:6,sm:24}},[e("a-form-item",{attrs:{label:"Status"}},[e("a-select",{attrs:{value:t.order_status,filterOption:!1},on:{change:function(a){return t.order_status=a}}},t._l(t.orderStatus,function(a){return e("a-select-option",{key:a.value},[t._v(t._s(a.label))])}),1)],1)],1)],1),e("a-button",{attrs:{type:"primary"},on:{click:t.hanldeSearch}},[t._v("Search & Refresh")]),e("a-button",{staticClass:"buttonStyle",attrs:{type:"primary"},on:{click:t.hanldeClean}},[t._v("Clean")]),e("a-button",{staticClass:"buttonStyle",attrs:{type:"primary"},on:{click:function(a){t.exportModal.visible=!0}}},[t._v("Export")])],1)],1),e("a-tabs",{attrs:{defaultActiveKey:0,activeKey:t.activeKey,animated:!1},on:{change:t.handleTableChange}},t._l(t.orderStatus,function(a){return e("a-tab-pane",{key:a.value,attrs:{tab:a.label}},[e("order-list",{ref:"orders",refInFor:!0,attrs:{queryParam:t.queryParam,status:a.value}})],1)}),1)],2)],1)},n=[],s=(e("7514"),function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("a-spin",{directives:[{name:"action",rawName:"v-action:query",arg:"query"}],attrs:{spinning:t.loading}},[e("s-table",{ref:"table",attrs:{size:"default",rowKey:function(t){return t.id},columns:t.book_columns,data:t.loadData,bordered:"",fixed:""},scopedSlots:t._u([{key:"order",fn:function(a,r){return e("span",{},[[e("p",{staticClass:"order-info"},[t._v("\n            产品名称:\n            "),e("span",{staticClass:"bold ligth-blue"},[t._v("【"+t._s(r["product"])+" - "+t._s(r["variant"])+"】")])]),e("p",{staticClass:"order-info"},[t._v("\n            执行日期:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(t._f("moment")(r["day"]+" "+r["time"],"YYYY-MM-DD HH:mm")))])]),e("p",{staticClass:"order-info"},[t._v("\n            成人数量:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["adult_quantity"]))])]),r["child_quantity"]>0?e("p",{staticClass:"order-info"},[t._v("\n            儿童数量:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["child_quantity"]))])]):t._e(),e("p",{staticClass:"order-info"},[t._v("\n            客人信息:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["guest_info"])+" "+t._s(r["guest_contact"]))])]),e("p",{staticClass:"order-info"},[t._v("\n            客户备注:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["guest_remark"]))])]),null!=r["remark"]&&r["remark"].length>0?e("p",{staticClass:"order-info"},[t._v("订单备注:"+t._s(r["remark"]))]):t._e()]],2)}},{key:"price",fn:function(a,r){return e("span",{},[[e("p",{staticClass:"order-info"},[t._v("\n            成人:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["adult_price"])+"$")])]),r["child_quantity"]>0?e("p",{staticClass:"order-info"},[t._v("\n            儿童:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["child_price"])+"$")])]):t._e(),e("p",{staticClass:"order-info"},[t._v("\n            优惠:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["offer"])+"$")])]),e("p",{staticClass:"order-info"},[t._v("\n            总价:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["total"])+"$")])]),e("br"),e("p",{staticClass:"order-info"},[t._v("\n            成人单价:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["adult_unit_price"])+"$")])]),r["child_quantity"]>0?e("p",{staticClass:"order-info"},[t._v("\n            儿童单价:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(r["child_unit_price"])+"$")])]):t._e()]],2)}},{key:"payment",fn:function(a){return e("span",{},t._l(a.payment,function(a){return e("div",{key:a.id},[e("p",{staticClass:"order-info"},[t._v("\n            金额:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(a.total)+"$")])]),e("p",{staticClass:"order-info"},[t._v("\n            捕捉金额:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(a.captured)+"$")])]),e("p",{staticClass:"order-info"},[t._v("\n            状态:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(t.payStatus[a.status].label))])]),e("p",{staticClass:"order-info"},[t._v("\n            动作:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(t.payActions[a.action].label))])]),e("p",{staticClass:"order-info"},[t._v("\n            客户余额:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(a.customer_balance)+"$")])]),e("p",{staticClass:"order-info"},[t._v("\n            修改:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(t._f("moment")(a.change_at,"YYYY-MM-DD HH:mm")))])]),e("p",{staticClass:"order-info"},[t._v("\n            说明:\n            "),e("span",{staticClass:"bold"},[t._v(t._s(a.description))])]),e("p",[t.$auth("Payment.edit")&&3==a.status?e("a-popconfirm",{attrs:{title:"Are you sure to do this?",okText:"Yes",cancelText:"No"},on:{confirm:function(e){return t.paymentRefund(a)}}},[e("a",{attrs:{href:"javascript:;"}},[t._v("Confrim")])]):t._e()],1),e("br")])}),0)}},{key:"create_at",fn:function(a){return e("span",{},[[e("span",[t._v(t._s(t._f("moment")(a,"MM-DD HH:mm")))])]],2)}},{key:"action",fn:function(a,r){return e("span",{},[[0==t.status?e("div",[t.$auth("Order.edit")?e("a",{attrs:{href:"javascript:;"},on:{click:function(a){return t.changeOrderStatus(r,1)}}},[t._v("confirm")]):t._e(),e("br"),t.$auth("Order.edit")?e("a-popconfirm",{attrs:{title:"Are you sure cancel?",okText:"Yes",cancelText:"No"},on:{confirm:function(a){return t.changeOrderStatus(r,3)}}},[e("a",{attrs:{href:"javascript:;"}},[t._v("cancel")])]):t._e()],1):t._e(),1==t.status?e("div",[t.$auth("Booking.add")?e("a",{attrs:{href:"javascript:;"}},[t._v("add booking")]):t._e(),e("br"),t.$auth("Order.edit")?e("a",{attrs:{href:"javascript:;"},on:{click:function(a){return t.changeOrderStatus(r,2)}}},[t._v("complete")]):t._e()]):t._e(),2==t.status?e("div"):t._e(),3==t.status?e("div",[t.$auth("Payment.add")?e("a",{attrs:{href:"javascript:;"},on:{click:function(a){return t.refund.handle(r)}}},[t._v("add refund")]):t._e(),e("br"),t.$auth("Order.edit")|t.$auth("Payment.edit")?e("a",{attrs:{href:"javascript:;"},on:{click:function(a){return t.changeOrderStatus(r,5)}}},[t._v("complete")]):t._e()]):t._e(),5==t.status?e("div"):t._e(),e("div",[e("a",{attrs:{href:"javascript:;"}},[t._v("remark")])])]],2)}}])})],1),e("a-modal",{attrs:{title:"Refund Form"},model:{value:t.refund.visible,callback:function(a){t.$set(t.refund,"visible",a)},expression:"refund.visible"}},[e("a-form",[e("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"Amount",required:!0}},[e("a-input-number",{staticStyle:{width:"200px"},attrs:{min:0,max:t.refund.data.total,defaultValue:0,precision:2,step:.5},model:{value:t.refund.form.amount,callback:function(a){t.$set(t.refund.form,"amount",a)},expression:"refund.form.amount"}})],1),e("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"Description"}},[e("a-textarea",{attrs:{autosize:{minRows:3}},model:{value:t.refund.form.description,callback:function(a){t.$set(t.refund.form,"description",a)},expression:"refund.form.description"}})],1)],1),e("template",{slot:"footer"},[e("a-button",{key:"back",on:{click:function(a){t.refund.visible=!1}}},[t._v("Return")]),e("a-button",{key:"submit",attrs:{type:"primary",loading:t.refund.loading},on:{click:t.refund.submit}},[t._v("Submit")])],1)],2)],1)}),o=[],i=(e("c5f6"),e("2af9")),l=e("f8b7"),u=e("365c"),d=e("b775");function c(t){return Object(d["b"])({url:u["a"].payment+"".concat(t,"/")+"refund/",method:"put"})}var f=e("f3b8"),p=[{value:0,label:"未支付"},{value:1,label:"部分支付"},{value:2,label:"全部付清"},{value:3,label:"退款中"},{value:4,label:"部分退款"},{value:5,label:"全部退款"}],m=[{value:0,label:"扣费"},{value:1,label:"退款"},{value:2,label:"充值"}],v={name:"OrderList",components:{STable:i["e"],Ellipsis:i["b"]},props:{queryParam:{type:Object,default:void 0},status:{type:Number,default:0}},data:function(){var t=this;return{loading:!1,payStatus:p,payActions:m,labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},book_columns:[{title:"OrderID",dataIndex:"orderID",width:"50px"},{title:"RelatedID",dataIndex:"relatedID",width:"50px"},{title:"Customer",dataIndex:"customer",width:"100px"},{title:"Order Info",scopedSlots:{customRender:"order"}},{title:"Booking Info",scopedSlots:{customRender:"booking"}},{title:"Payment",scopedSlots:{customRender:"payment"},width:"180px"},{title:"Price",scopedSlots:{customRender:"price"},width:"140px"},{title:"Operator",dataIndex:"operator",width:"50px"},{title:"Create",dataIndex:"create_at",scopedSlots:{customRender:"create_at"},width:"40px"},{title:"Action",dataIndex:"action",scopedSlots:{customRender:"action"},width:"90px",fixed:"right"}],loadData:function(a){return Object(l["d"])(Object.assign(a,t.queryParam)).then(function(t){return t.result})},refund:{loading:!1,visible:!1,handle:function(a){t.refund.visible=!0,t.refund.data=a,t.refund.form.amount=a.total,t.refund.form.description=""},data:{total:void 0},form:{amount:0,description:""},submit:function(){t.refund.loading=!0,Object(l["e"])(t.refund.data.id,t.refund.form).then(function(a){return t.refresh(!1)}).catch(function(a){return t.checkError(a)}).finally(function(){t.refund.loading=!1,t.refund.visible=!1})}}}},methods:{refresh:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$refs.table.refresh(t)},changeOrderStatus:function(t,a){var e=this;this.loading=!0,Object(l["f"])(t.id,Object.assign({},t,{order_status:a})).then(function(t){return e.refresh(!1)}).finally(function(){e.loading=!1})},paymentRefund:function(t){var a=this;this.loading=!0,c(t.id).then(function(t){return a.refresh(!1)}).finally(function(){return a.loading=!1})},checkError:function(t){var a=Object(f["a"])(t,"amount");for(var e in a)a[e]&&this.$notification["error"]({message:e,description:a[e],duration:4})}}},b=v,_=(e("2b1f"),e("2877")),h=Object(_["a"])(b,s,o,!1,null,null,null),y=h.exports,C=[{value:0,label:"New"},{value:1,label:"Confirm"},{value:2,label:"Complete"},{value:3,label:"Cancel"},{value:5,label:"Refund"},{value:-1,label:"All"}],k={components:{OrderList:y},watch:{order_status:function(t,a){this.queryParam.order_status=-1==t?void 0:t},day:function(t,a){null!=t&&void 0!=t&&t.length>0?(this.queryParam.start_day=t[0].format("YYYY-MM-DD"),this.queryParam.end_day=t[1].format("YYYY-MM-DD")):(this.queryParam.start_day=void 0,this.queryParam.end_day=void 0)},activeKey:function(t,a){this.queryParam.order_status=-1==t?void 0:t}},data:function(){return{activeKey:0,orderStatus:C,queryParam:{orderID:void 0,relatedID:void 0,order_status:0,start_day:void 0,end_day:void 0,variant:void 0,product:void 0,customer:void 0,operator:void 0},day:void 0,order_status:-1}},methods:{refresh:function(){var t=this;this.$refs.orders.find(function(a){return a.status==t.activeKey}).refresh()},handleTableChange:function(t){var a=this;this.activeKey=t,this.$refs.orders.find(function(t){return t.status==a.activeKey})?this.$nextTick(function(){return a.refresh()}):this.hanldeClean()},hanldeClean:function(){var t=this;this.queryParam={orderID:void 0,relatedID:void 0,order_status:this.activeKey,start_day:void 0,end_day:void 0,variant:void 0,product:void 0,customer:void 0,operator:void 0},this.$nextTick(function(){return t.refresh()})},hanldeSearch:function(){this.refresh()}}},x=k,g=(e("51f0"),Object(_["a"])(x,r,n,!1,null,null,null));a["default"]=g.exports},"9bfb":function(t,a,e){},ca16:function(t,a,e){},f3b8:function(t,a,e){"use strict";function r(t){if(t&&t.response&&t.response.data&&t.response.data.message){for(var a={},e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];for(var s=0,o=r;s<o.length;s++){var i=o[s];a[i]=t.response.data.message[i]||null}return a}return null}e.d(a,"a",function(){return r})},f8b7:function(t,a,e){"use strict";e.d(a,"a",function(){return s}),e.d(a,"d",function(){return o}),e.d(a,"c",function(){return i}),e.d(a,"f",function(){return l}),e.d(a,"b",function(){return u}),e.d(a,"e",function(){return d});var r=e("365c"),n=e("b775");function s(t){return Object(n["b"])({url:r["a"].checkout,method:"post",data:t})}function o(t){return Object(n["b"])({url:r["a"].order,method:"get",params:t})}function i(t){return Object(n["b"])({url:r["a"].order+"".concat(t,"/"),method:"get"})}function l(t,a){return Object(n["b"])({url:r["a"].order+"".concat(t,"/"),method:"put",data:a})}function u(t){return Object(n["b"])({url:r["a"].order,method:"post",data:t})}function d(t,a){return Object(n["b"])({url:r["a"].order+"".concat(t,"/")+"refund/",method:"put",data:a})}}}]);